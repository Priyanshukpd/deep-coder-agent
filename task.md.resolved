# Agent Improvements

## High Impact
- [x] #1 Runtime Pre-Check ‚Äî `_check_runtime()` verifies java/node/docker/go/etc. installed
- [x] #2 Multi-Language Error Detection ‚Äî parses Java/Node/Go/Rust/Dart/C++ tracebacks
- [x] #3 Stack Context in Planning ‚Äî passes detected stack to LLM planning prompt

## Medium Impact
- [x] #4 Health Check for Servers ‚Äî `_detect_port()` + `_health_check()` after `_run_server()`
- [x] #5 Multi-Step Run Commands ‚Äî `run_commands` array in plan for sequential execution
- [x] #6 Auto-Git Commit ‚Äî Step 12 auto-commits on success with `[god-mode-agent]` prefix

## Verification
- [x] **Phase 11: Cognitive Enhancements ("The Brain")**
    - [x] Smart Stack Detection (LLM Fallback in `RepoDiscovery`)
    - [x] Persistent Memory (`.agent/architecture.md`)
    - [x] Semantic Code Search (LLM-guided codebase navigation)

- [x] **Phase 12: Tooling Depth ("The Hands")**
    - [x] Docker Inspector (Logs, Inspect, Exec)
    - [x] Database Inspector (Schema, Seed Verification)
    - [x] Browser Testing (Headless verification)

- [ ] **Phase 13: Interactive Troubleshooting ("The Mouth")**
    - [x] Guided Debugging (Ask for help after N failures)
    - [ ] Clarification Mode (Ambiguity detection)
    - [ ] Clarification Mode (Ambiguity detection)

## Phase 1-13 Polish (Robustness)
- [x] **Active Debugging**: Auto-run Inspectors (Docker/DB) on error and feed logs to LLM
- [x] **Process Resilience**: `wait_for_port` detects early crashes immediately
- [ ] **Smart Context 2.0**: `_select_relevant_files` sees snippets, not just paths

## Phase 14: External Knowledge (The "Library Card") üìö
- [x] **Doc Crawler Tool**: `search_docs(query)` and `read_page(url)`
- [x] **Integration**: `_gather_diagnostics` searches docs on `ImportError`/`AttributeError`

## Phase 15: Hybrid Control ("The Co-Pilot Switch") üéõÔ∏è
- [x] **Interactive Hook**: `TaskExecutor` accepts `approval_callback`.
- [x] **Checkpoints**: Pause at `PLAN_REVIEW` and `CODE_REVIEW`.
- [x] **Chat Toggle**: `/mode auto` vs `/mode interactive`.

## Phase 16: Visual Perception (The "Visual Cortex") üëÅÔ∏è
- [x] **Browser Upgrade**: `BrowserTester` returns valid screenshots.
- [x] **Multimodal Loop**: Feed screenshots to LLM for layout analysis.
- [x] **Visual Verify**: `verify_visuals("Check if button is centered")`.

## Phase 17: Interactive Plan Refinement üó£Ô∏è
- [x] **Feedback Loop**: Allow user to provide text feedback during `PLAN_REVIEW`.
- [x] **Regeneration**: `TaskExecutor` regenerates plan based on feedback.
- [x] **Chat UI**: Update `/mode interactive` handler to accept flexible input.

## Phase 18: Knowledge Graph Integration üß†
- [x] **Graph Builder**: `KnowledgeGraph` class to parse imports (Universal Regex support).
- [x] **Context Injection**: `generate_plan` uses graph to find related files.
- [x] **Impact Analysis**: Identify downstream dependents of changed files.

## Phase 19: Final System Verification üß™
- [x] **Scenario**: Create Flask app with UI component.
- [x] **KG Check**: Ensure test file linked via import.
- [x] **Visual Check**: Verify "Blue Submit Button".
- [x] **Execution**: End-to-end success.

## Phase 20: God Mode Enhancements (The Hybrid Architecture) üöÄ
- [x] **LSP Integration**: `agent/tools/lsp.py` (Real-time error checking).
- [x] **Visual Feedback**: `agent/tools/visual.py` (Quick screenshot + logs).
- [x] **Specialized Personas**: `agent/core/prompt.py` (Mode-specific prompts).
- [x] **Specialized Personas**: `agent/core/prompt.py` (Mode-specific prompts).
- [x] **Verification**: Fix a broken React app using the new tools.

## Phase 21: Autonomy & Interaction (The "Devin" Layer) ü§ñ
- [x] **Interactive Browser**: Upgrade `agent/tools/browser_tester.py` to support `click`, `type`, `wait_for`.
- [x] **Auto-Healing Verification**: Update `TaskExecutor` to auto-retry 3 times with different plans if verification fails.
- [x] **End-to-End Test**: Verify a dynamic flow (Form Submission) using the new tools.

## Phase 22: Supply Chain Robustness ("The Analyst's Eye") üõ°Ô∏è
- [x] **Heuristic Refinement**: Correctly flag standard library name collisions (e.g., `os` vs `cors`).
- [x] **Advisor Tool**: Implement `SecurityAdvisor` for LLM-powered second opinions.
- [x] **Verification**: Auto-Healing confirms standard libraries as SAFE autonomously.

## Phase 23: Autonomous Project Management (Project 'Wings') üìÇ‚ú®
- [x] **Data Migration**: Autonomous file reorganization into `src/`, `data/`, etc.
- [x] **Verification**: End-to-end success in `wings` repo with zero human help.

## Phase 24: Shell Power ("The Direct Path") ‚ö°üêö
- [x] **Planning Logic**: Update `PLANNING_PROMPT` to prefer `mv`, `rm`, `cp`.
- [x] **Verification**: Successful autonomous checkout and cleanup using direct shell commands.

## Phase 25: Mission v7.5.1.1 - Sealed & Autonomous (Security Advisor, Shell Power, Project Wings)
- [x] **Final Documentation**: Update all `*.md.resolved` files with the autonomous kernel specification.
## Phase 26: Reactive Feedback Loop (Human-Agent Jam, CLI Interactive Loop, Reactive Re-Planning)
- [x] Phase 27: The React Evolution (FastAPI Backend + React Frontend + Decoupled UI)
## Phase 28: Smarter Self-Correction Loop üß†
- [x] **Stateful Fixes**: Pass a history of past `(error, code)` attempts to the `fix_error` function.
- [x] **Prompt Engineering**: Update the LLM prompt in `fix_error` to explicitly warn against repeating previous failed attempts.
- [x] **Implementation**: Modify `agent/core/task_executor.py` (`Step 9` and `Step 10` loops) to accumulate and pass `fix_history`.
- [x] **Dynamic Retry Scaling**: Replaced hardcoded `MAX_FIX_ATTEMPTS = 3` with configurable `GOD_MODE_MAX_FIX_ATTEMPTS` defaulting to 7.
## Phase 29: Chain-of-Thought (CoT) Autonomy üß†üí¨
- [x] **CoT Prompts**: Update `CODE_SYSTEM_PROMPT_TEMPLATE` and `FIX_SYSTEM_PROMPT_TEMPLATE` to explicitly demand an `<analysis>` block assessing the root cause / project architecture before writing the ````[language] ... ```` code.
- [x] **Robust Extraction**: Update the LLM response parser in `generate_code` and `fix_error` to reliably find the code block even if prefixed with a CoT monologue.
- [x] **Terminal Transparency**: Extract the `<analysis>` block (if present) and print it to the terminal so the user can verify the Agent's reasoning during code generation and auto-healing.

## Phase 30: Context-Aware Intent Routing üß†
- [x] **Project Awareness**: Pass full repository scanning context (`repo_map.stack.summary` and file count) directly into the `SYSTEM_PROMPT` of `intent.py` so the classifier knows whether it's looking at an empty directory or a populated project.
- [x] **Strict CLI Guardrails**: Modified `run_full_pipeline` in `cli.py` to hard-abort if `clarification_needed` is true during `--yes` automation runs, ensuring the Agent never hallucinates an incorrect greenfield `generate` on ambiguous single-line requests.

## Phase 31: End-to-End Planning Intelligence üß†
- [x] **Project File Tree Architecting**: Modified `_read_smart_context` to actively inject the top 200 files in the repo structure to the top of the LLM context, ensuring the planner knows the precise structural boundaries of the codebase before selecting files.
- [x] **Zero-Shot JSON Schema Fix**: Resolved a critical hallucination bug in `PLANNING_PROMPT` where the agent was told to "output as described in schema" but wasn't provided one.
- [x] **Autonomous File Introspection Rules**: Hardcoded intelligence directives into `PLANNING_PROMPT` instructing the agent to list logical features and implicitly `[MODIFY]` existing UI or Backend codebase files, aggressively preventing prompt-driven file duplication.
- [x] **Chain-of-Thought Validation**: Verified the agent outputs a successful `üß† Planning Analysis` evaluating the exact changes required in existing files (e.g. `src/renderer.py` in the snake game) before writing out the structured execution JSON.

## Phase 32: Intelligent Early Stopping üõë
- [x] **Create Abort Signal**: Introduce an `@ABORT: <reason>` pattern for the Agent to output in its `<analysis>` block if it realizes a fix is fundamentally unachievable.
- [x] **Implementation Exception**: Create standard `class AbortFixLoopException(Exception): pass` inside `task_executor.py`.
- [x] **Smart Extraction**: Parse the `<analysis>` block inside `fix_error` and raise `AbortFixLoopException` if the abort string is detected.
- [x] **Loop Unwinding**: Catch `AbortFixLoopException` inside `_execute_inner` (Step 9 default loop, Step 10 Verification auto-healing loop), print the intelligent abort reason, and cleanly terminate the run without burning remaining retry attempts.

## Phase 33: React UI Real-Time Execution Streaming üì°
- [x] **Log Capture**: Implement a `LogCapturer` or patch `sys.stdout` in the FastAPI backend to capture standard print statements during agent execution.
- [x] **SSE Endpoint**: Create a `GET /api/stream/{session_id}` Server-Sent Events endpoint in `server.py` to stream execution logs in real-time.
- [x] **React Frontend Integration**: Update `ui/src/App.jsx` to listen to the EventSource and display a real-time terminal or log stream beneath the current executing action.
