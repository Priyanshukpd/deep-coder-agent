# Task: Build Production-Ready Dev Agent

- [x] **Architecture Design**
    - [x] Define Tech Stack (Python/FastAPI + Next.js)
    - [x] Create Development Roadmap
    - [x] Synthesize from Windsurf/Devin/Cursor/Replit/Lovable
    - [x] Upgrade to v4.0 (Intent Classifier, State Machine, Safety)
- [x] **Phase 1: Control & Safety (The Foundation)**
    - [x] Initialize Python Project
    - [x] Implement [AgentState](file:///Users/munishm/Documents/god-mode-agent/agent/state.py#16-31) enum + transition rules
    - [x] Implement [RiskBudget](file:///Users/munishm/Documents/god-mode-agent/agent/risk_budget.py#40-221) (multi-dimensional)
    - [x] Implement `CommandClassifier` + safety policy
    - [x] Define Human Approval Contract ([ApprovalRequest](file:///Users/munishm/Documents/god-mode-agent/agent/approval.py#50-120) artifact)
    - [x] Implement Decision Logger (Structured JSON Audit Trail)
    - [x] Implement RBAC System (Roles & Permissions)
    - [x] Build [StateMachineController](file:///Users/munishm/Documents/god-mode-agent/agent/controller.py#20-208)
    - [x] Simulate 3 fake tasks (Dry Run)
    - [x] Implement Intent Confidence & Ambiguity Fallback
    - [x] Implement Precondition Checks (Git HEAD / Checksums)
    - [x] Implement Governance Self-Test Module (14/14 tests)

- [x] **Phase 2: Execution Hardening (The Hands)**
    - [x] Implement Task Isolation (Atomic Branching + Clean Tree Invariant)
    - [x] Implement Optimistic Merge Guard (CI SHA == Branch HEAD)
    - [x] Implement Plan Envelope Validator (Inputs + Toolchain + Dep Freeze)
    - [x] Implement Atomic State Transitions (Invariant Guard + Rollback)
    - [x] Implement Adaptive Kill Switch Cascade (Stack-Aware + Heartbeat + Extension)
    - [x] Implement Network Policy (OS-Level Block + Lockfile Hash)
    - [x] Define Rollback Domains (Atomic: `git reset --hard`)
    - [ ] Implement CI Gate Integration

- [x] **Phase 3: Cognitive Hardening (The Mind)**
    - [ ] Implement TDD Gate (Red/Green Integrity Check)
    - [ ] Implement Anti-Mocking Validator (No Tautologies)
    - [x] Implement Bounded LSP Loop (Syntax Retry Only)
    - [ ] Implement Replay Log (Tool Hash + Sampling Hash + Manifest)
    - [x] Implement Non-Determinism Budget (Temp=0 Enforcement)
    - [ ] Implement Ultra-Strict Express Lane (Diff Guard: No Executable/Shebang)
    - [x] Implement Supply Chain Security (Typosquatting Check)
    - [ ] Implement Graph-Based Context Retrieval

- [x] **Phase 4: Execution & Diffs (The Work)**
    - [x] Implement sandboxed `run_command` with smart timeouts
    - [x] Implement diff-first editing (patch â†’ apply â†’ rollback)
    - [x] Implement Secrets Policy (Redaction & Injection)
    - [ ] Shell session persistence

- [x] **Phase 5: Planning & Discipline (The Manager)**
    - [x] Implement IntentClassifier (LLM-powered)
    - [x] Enforce task.md + implementation_plan.md
    - [ ] Implement `ImpactAnalysis` (dependency graph)
    - [x] Implement `RepoDiscovery` (detect stack)

- [x] **Phase 6: Verification & Feedback (The Tester)**
    - [x] Hierarchical verification pipeline (multi-tier)
    - [ ] Test-generation-first workflow
    - [x] Human feedback loop (chat-based)

- [ ] **Phase 7: Deep Intelligence (The Brain)**
    - [ ] Background ChromaDB indexing
    - [ ] `ripgrep` wrapper (Tier 1) + `semantic_search` (Tier 2)
    - [ ] External Docs RAG

- [x] **Phase 8: Multi-Stack Execution (v8.0)**
    - [x] Create `stack_profiles.py` (Python, Java, Node, Go, Rust, Dart, Docker, Generic)
    - [x] Stack detection from task keywords + repo analysis
    - [x] Parameterize prompts with `{language}` (CODE + FIX templates)
    - [x] LLM-driven command planning (install/compile/lint/run/test)
    - [x] Generic dependency installer (npm/pip/cargo/go mod/etc.)
    - [x] Compile step for Java/Go/Rust/C++
    - [x] Multi-language lint (LSP for Python, subprocess for others)
    - [x] Multi-language verification pipeline
    - [x] Chat UI updated for multi-stack awareness

- [x] **Phase 9: Robustness Improvements**
    - [x] Runtime pre-check (`shutil.which()` for java/node/docker/go + install hints)
    - [x] Universal error detection (known patterns + catch-all `file.ext:lineN` for any language)
    - [x] Stack context passed to LLM during planning
    - [x] Smart command timeouts (Docker=10m, builds=5m, tests=3m)
    - [x] Server detection + background Popen + health check (`_detect_port` + `_health_check`)
    - [x] Multi-step run commands (`run_commands[]` array)
    - [x] Auto-git commit on success (`[god-mode-agent] <summary>`)
    - [x] Graceful OS error handling + PATH augmentation
    - [x] Background process cleanup in `finally` block

- [x] **Phase 10: Real-World Readiness**
    - [x] Parallel Process Support (Backend + Frontend) via `ProcessManager`
    - [x] Streaming Output (Real-time logs)
    - [x] Environment Variable Handling (.env detection/generation)
    - [x] Database Lifecycle Management (Migrate/Seed hooks)

- [x] **Phase 11: Cognitive Enhancements ("The Brain")**
    - [x] Smart Stack Detection (LLM Fallback)
    - [x] Persistent Memory (`.agent/architecture.md`)
    - [x] Semantic Code Search (`_select_relevant_files`)

- [x] **Phase 12: Tooling Depth ("The Hands")**
    - [x] Docker Inspector
    - [x] Database Inspector
    - [x] Browser Tester

- [x] **Phase 13: Interactive Troubleshooting ("The Mouth")**
    - [x] Guided Debugging (Ask for help)

- [x] **Phase 14: External Knowledge ("The Library Card")** ðŸ“š
    - [x] Doc Crawler Tool
    - [x] Auto-Research on Import Errors

- [x] **Phase 1-13 Polish (Robustness)** ðŸ’Ž
    - [x] Active Debugging (Auto-Inspectors)
    - [x] Process Resilience (Fast Failure Detection)

